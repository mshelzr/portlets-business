var moodropdown=new Class({Implements:[Options,Events],options:{dropname:"",maxscroll:5,idlist:"list",nameHiden:"dropdown",data:"",selectedValue:0},initialize:function(a,b){return this.setOptions(b),this.dropdown=a,this.selectValue="",this.SelectElement="",this.selectedIndex=0,this.unselecteddown=!1,this.unselectedup=!1,this.updown=!1,this.listelements=Array(),this.iSteps=null!=this.options.data?this.options.data.length.toInt():0,this.maxscroll=this.options.maxscroll.toInt(),this.height=this.iSteps>this.maxscroll?130:26*this.iSteps,this.positionstep=Math.ceil((this.height-40)/this.iSteps),this.itop=0,this.ItemSelected="",this.offMouse=!1,null==this.options.data?!1:(this.addItems(this.options.data),void 0)},addItems:function(a){a=a||this.options.data;var b=this.dropdown.getSize(),c={height:this.height,width:b.x,position:"absolute",display:"none"},d=this.options.idlist+this.options.nameHiden,e=new Element("input",{type:"text",name:this.options.nameHiden,id:this.options.nameHiden,value:"","class":"textdropdown",styles:{opacity:"0","z-index":"-1",position:"absolute"}}).inject(this.dropdown),f=this.dropdown.getElement("div")||new Element("div"),g=$(document.body).getElement("div#"+d)||new Element("div",{"class":"droplist",id:d,styles:c}).inject($(document.body)),h=new Element("div",{styles:{overflow:"hidden",height:this.height,border:"1px solid #C7C7C7","border-top":"none",width:b.x-2}}),i=new Element("ul",{styles:{width:b.x-2}});g.set("html",""),h.inject(g),f.set("html",""),f.inject(this.dropdown),this.addSCroll(g,h),this.addkeyupdown(e),this.dropdownpositionwindow(g,b),this.dropdownposition(b,g,e),a.each(function(a){var b=new Element("li",{valor:a.id,html:a.etiqueta}).inject(i);"1"==a.defecto&&0==this.options.selectedValue?(f.set("html",a.etiqueta),$(e).value=a.id,this.SelectElement=b):this.options.selectedValue==a.id&&(f.set("html",a.etiqueta),$(e).value=a.id),b.addEvents({click:function(){var a=b.get("text"),c=b.get("valor"),d=this.dropdown,e=d.getElement("input"),f=d.hasClass("valid['rdropdown']");$(e).value=c,d.getElement("div").set("text",a),g.setStyle("display","none"),e.value>0&&1==f?(d.removeClass("text-error"),d.addClass("bgfa"),d.getParent(".campos-oblig").getNext(".form-error").setStyle("display","none")):0==e.value&&1==f&&(d.addClass("text-error"),d.removeClass("bgfa"),d.getParent(".campos-oblig").getNext("div.form-error").setStyle("display","block")),this.selectValue!=c&&(this.selectValue=c,this.fireEvent("xChange",b))}.bind(this),mouseover:function(a){if(!this.offMouse){a.stop(),g.getElements("li").removeClass("selectitem"),b.addClass("selectitem");var c=b.get("valor");this.listelements.each(function(a,b){a.get("valor")==c&&(this.selectedIndex=b+1,this.selectedIndexold=b,this.itop=this.positionstep*this.selectedIndex)}.bind(this))}}.bind(this)})}.bind(this)),i.inject(h)},dropdownpositionwindow:function(a,b){window.addEvent("resize",function(){var c=this.dropdown.getPosition();a.setStyles({top:c.y+b.y,left:c.x})}.bind(this))},addSCroll:function(a,b){var c=a.measure(function(){return{scrollSize:this.getScrollSize(),size:this.getSize()}});if(this.iSteps>this.maxscroll){var d=new Element("div",{"class":"contentKnob",styles:{position:"absolute",right:"5px",top:"1px",width:"6px",height:c.size.y-2,padding:"0"}}).inject($(a)),e=new Element("span",{"class":"dropdownknob",styles:{display:"block",width:"8px",border:"1px solid #a7a9ac","border-radius":"2px",height:"40px",background:"#a7a9ac","z-index":"11"}}).inject(d);slider=new xSlider(d,e,{mode:"vertical",onChange:function(a){b.scrollTop=26*a},steps:this.iSteps})}a.addEvents({mouseleave:function(){a.setStyle("display","none")}})},addkeyupdown:function(a){a.addEvent("keyup",function(a){var b=a.key,c=this.listelements.length-1;if(iHeight=this.height-40,availableKeys=["tab","esc","enter","up","down","left","right"],availableKeys.contains(a.key))switch(b){case"down":case"right":this.offMouse=!0,this.updown&&(this.updown=!1,this.selectedIndex=this.selectedIndexold,this.selectedIndexold=this.selectedIndexold-1),this.unselectedup=!1,this.listelements[this.selectedIndex]?(this.listelements[this.selectedIndex].addClass("selectitem"),this.selectedIndex>0&&!this.unselecteddown&&this.listelements[this.selectedIndexold].removeClass("selectitem"),this.iSteps>this.maxscroll&&(slider.fireEvent("onChange",this.selectedIndex),this.itop<iHeight&&(knob.setStyle("top",this.itop),this.itop=this.itop+this.positionstep))):(this.selectedIndex=this.selectedIndex-1,this.unselecteddown=!0),this.selectedIndexold=this.selectedIndex,this.selectedIndex<c?this.selectedIndex=this.selectedIndex+1:this.unselecteddown=!0;break;case"up":case"left":this.offMouse=!0,this.updown||(this.updown=!0,this.selectedIndex=this.selectedIndexold,this.selectedIndexold=this.selectedIndexold+1),this.unselecteddown=!1,this.selectedIndexold=this.selectedIndex,this.selectedIndex>0?this.selectedIndex=this.selectedIndex-1:this.unselectedup=!0,this.listelements[this.selectedIndex]?(this.listelements[this.selectedIndex].addClass("selectitem"),this.selectedIndex>=0&&!this.unselectedup&&this.listelements[this.selectedIndexold].removeClass("selectitem"),this.iSteps>this.maxscroll&&(slider.fireEvent("onChange",this.selectedIndex),this.itop>0&&(this.itop=this.itop-this.positionstep,knob.setStyle("top",this.itop)))):(this.selectedIndex=this.selectedIndex+1,this.unselectedup=!0);break;case"enter":break;case"esc":contentList.fireEvent("mouseleave")}}.bind(this))},dropdownposition:function(a,b){this.dropdown.addEvents({click:function(){this.offMouse=!1;var c=this.dropdown.getPosition();$$(".droplist").setStyle("display","none");var d,e;if(this.dropdown.hasClass("dropdownsmall"))switch(Browser.name){case"chrome":case"opera":case"safari":d=c.x,e=c.y+a.y+26;break;case"firefox":d=c.x+1,e=c.y+a.y+26;break;case"ie":Browser.ie9||Browser.ie8?(d=c.x,e=c.y+a.y+26):(Browser.ie7||Browser.ie6)&&(d=c.x,e=c.y+a.y+11)}else d=Browser.firefox||Browser.chrome?c.x+1:c.x,e=c.y+a.y;b.setStyles({display:"block",top:e,left:d})}.bind(this)})}});